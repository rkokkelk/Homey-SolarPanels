<<<<<<< HEAD
<style type="text/css">
	.form-group, .input-field {
		display: flex;
		flex-direction: column;
		align-items: center;
	}

	.input-field {
		margin-top: 10px;
	}

	.submit-button {
		margin-top: 10px;
	}
</style>

<div class="form-group">
	<div class="input-field">
		<label>Please enter your PVOutput system ID and read only API key:</label>
		<input type="text" id="sid" placeholder="System ID" value="" />
		<input type="text" id="key" placeholder="Read-only API key" value="" />
	</div>

	<div class="input-field">
		<label>Give your inverter a name:</label>
		<input type="text" id="name" placeholder="Name" value="" />
	</div>

	<button class="submit-button" id="validate">Connect</button>
</div>

<script type="text/javascript">
	$(() => {
		$('#validate').click(() => {
			Homey.showLoadingOverlay();

			var sid = $('#sid').val();
			var key = $('#key').val();
			var name = $('#name').val();

			var deviceDefinition = {
				name,
				data: { sid },
				settings: {	key }
			};

			Homey.emit('validate', deviceDefinition, (error, result) => {
				if (error) {
					Homey.hideLoadingOverlay();
					Homey.alert(error);
				} else {
					Homey.createDevice(deviceDefinition, (error, result) => {
						if (error) {
							Homey.hideLoadingOverlay();
							Homey.alert(error);
						} else {
							Homey.done();
						}
					});
				}
			});
		});
	});
</script>
=======
<style type="text/css">
  .homey-solarpanels-form {
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .homey-solarpanels-submit-button {
    margin-top: auto;
  }

  .homey-solarpanels-help {
    display: flex;
    align-items: center;

    color: var(--homey-color-text-light);
  }

  .homey-solarpanels-help > svg {
    width: 1.25em;
    height: 1.25em;

    fill: var(--homey-color-text-light);

    margin-right: 0.5em;
  }
</style>

<form class="homey-form homey-solarpanels-form" onsubmit="onConnect(event)">
  <h1 class="homey-title">Please enter your details</h1>

  <div class="homey-form-group">
    <label class="homey-form-label" for="systemId">PVOutput System ID</label>
    <input
      class="homey-form-input"
      type="text"
      pattern="[0-9]{1,7}"
      id="systemId"
      placeholder="12345"
      value=""
    />

    <label class="homey-form-label" for="apiKey">
      PVOutput API key (read-only)
    </label>
    <input
      class="homey-form-input"
      type="text"
      id="apiKey"
      placeholder="6f106f62b9d6925a3d9ecbec53e450d5005d0ae5"
      value=""
    />
  </div>

  <button
    class="homey-button-primary-full homey-solarpanels-submit-button"
    type="submit"
  >
    Connect
  </button>
</form>

<script type="application/javascript">
  const onConnect = async (event) => {
    event.preventDefault(); // Prevent the form from submitting and refreshing the page

    Homey.showLoadingOverlay();

    const systemId = document.getElementById("systemId").value;
    const apiKey = document.getElementById("apiKey").value;

    Homey.emit("validate", { systemId, apiKey })
      .then(() => {
        Homey.showView("list_devices");
      })
      .catch((error) => {
        Homey.hideLoadingOverlay();
        Homey.alert(error.message);
      });
  };
</script>
>>>>>>> 3b50ae378b0b091b3122a73c16112410dff12fd7
